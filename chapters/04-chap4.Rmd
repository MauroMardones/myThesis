# Integrated stock assessment model on Antarctic Krill population dynamics {#chap4}


\vspace*{0.5cm}
\begin{flushright}
\textit{About models}
\textit{"...they are essentiall for understanding reality (dynamic population marine exploited resources), sould not be confussed with that reality itself"}\\
\textit{"The ecological detective" (Hilborn and Mangel, 1997)}
\end{flushright}
\vspace*{2cm}


## Introduction

Antarctic krill (*Euphausia superba*) is predominantly concentrated in the Western Antarctic Peninsula (WAP) [@Atkinson2019a; @McBride2021; @Kawaguchi2024], being the primary area for krill harvesting over the past four decades and also an area that is also a critical feeding ground for predators such as penguins, seals, and whales [@Watters2013; @Hill2016; @Gallagher2023a]. At the same time, the WAP is one of the regions most affected by climate change, experiencing rapid increases in ocean temperature, sea ice loss, and changes in primary productivity [@Turner2005; @Lima2013; @Atkinson2019a; @Morley2020; @Carrasco2021; @McBride2021]. These overlapping pressures have intensified scientific interest in understanding krill population dynamics from both an ecological and fisheries perspective in such a complex and changing environment [@Warwick-Evans2022; @Kawaguchi2024].

Given the importance of krill to the ecosystem and its commercial value, effectively managing krill stocks is essential to maintaining the balance of the Antarctic ecosystem while supporting sustainable fisheries. Recognizing this, the Commission for the Conservation of Antarctic Marine Living Resources (CCAMLR) has been working on a revised ecosystem-based approach [@Constable2011; @Watters2013; @Cavanagh2016; @Constable2023]. This strategy seeks to balance commercial harvesting with a precautionary framework that safeguards krill-dependent species in space and temporal scales. It comprises three key components: (i) stock assessments to establish precautionary harvest rates, (ii) periodic updates of krill biomass estimates at multiple spatial scales, and (iii) a spatial overlap analysis, to guide the spatial allocation of catches and mitigate ecosystem-wide risks [@Warwick-Evans2022; @Kawaguchi2024].

To provide scientific advice and recommendations on the status and standing stock of krill, CCAMLR has historically relied on dedicated scientific surveys [@Watters2013; @Hill2019; @Dornam2021; @Green2023]. However, changes in survey design—both methodological and spatial—have raised concerns about the reliability of these estimates, while the high costs associated with such surveys have further motivated the search for alternative stock estimation methods. More recently, and as part of a new strategy, CCAMLR has explored a variety of model-based (indirect) approaches to assess krill stock status and support fisheries management decisions [@Hill2019]. Some of these stock assessment models have used a single source of data—either fishery-dependent catches [@Wang2021] or survey-based monitoring programs [@Kinzey2011; @Kinzey2019; @Green2023]. Nowadays, the Generalized Yield Model (GRYM) [@Maschette2020] is a model-based approach used by CCAMLR to generate management recommendations, allowing adjustments to the decision rules to predefined catch limits set by CCAMLR [@Constable2000; @CCAMLR2010; @CCAMLR2021a]. However, model-based approaches exhibit limitations, including an effective integration of multiple data sources, incorporation of ecosystem-level variables into population dynamics, and accounting for the high spatial and temporal intrinsic variability of krill productivity [@Meyer2020; @Trathan2021].

Increasing evidence demonstrates that environmental conditions—such as sea surface temperature, sea ice extent, and phytoplankton availability—strongly influence krill recruitment, survival, and spatial distribution [@Murphy2007; @Flores2012; @Saba2014; @Morley2020; @Perry2020; @Walsh2020; @Vorrath2020; @Veytia2021]. Similarly, fluctuations in predator abundance and distribution can exert significant top-down control on krill populations [@Moosa2017; @Reisinger2022; @Baines2022; @Riaz2023; @Biuw2024]. There is now broad scientific consensus on the need for stock assessment models that incorporate multiple data sources, capture temporal and spatial variability, and explicitly account for ecosystem interactions [@Marshall2019]. Neglecting these ecosystem drivers can lead to biased estimates of stock status and suboptimal management advice [@Haltuch2009; @Richards2016; @Marshall2019; @Crone2019]. Therefore, stock assessment frameworks aligned with CCAMLR’s new strategy should explicitly incorporate these ecosystem components to more accurately represent krill population processes.

Integrating ecological complexity into krill stock assessments presents multiple challenges. Long-term data collection is often affected by changes in monitoring programs and sampling methodologies [@Hill2019], while some key regions of the WAP lack sufficient data to construct reliable krill population indices. Additional difficulties arise from indirect drivers—such as environmental variability and predator-prey interactions—which are difficult to quantify due to spatial and temporal heterogeneity, non-linear responses, and the combined effects of multiple stressors [@Constable2023]. Despite these challenges, substantial data exist on krill and associated environments. Fishery monitoring programs provide detailed biological data from catches through onboard scientific observers. Ecosystem monitoring, like the CCAMLR Ecosystem Monitoring Program (CEMP), tracks predator populations and environmental variability at key sites. Together, these initiatives support ecosystem-based management by offering insights into both direct fishery impacts and the broader ecological context influencing krill dynamics.

This diversity of data creates an opportunity to develop integrated assessment frameworks that account for the coupled biological, ecological, and fishery processes shaping krill populations. Spatially explicit approaches include the State-Space Assessment Model (SAM) [@Nielsen2021] and the Globally Applicable Area-Disaggregated General Ecosystem Toolbox (Gadget) [@Bartolino2011]. For statistical catch-at-age assessments, widely used frameworks include the C++ Algorithmic Stock Assessment Laboratory (CASAL) [@Bull2004] and Stock Synthesis (SS3) [@Methot2013], among others. These advanced tools offer robust methodologies to address existing data gaps while incorporating the full complexity of ecosystem and population dynamics [@Hoyle2020].

This study aims to integrate various data sources on krill (*Euphausia superba*), including fishery operations (e.g. catches and effort distribution), biological characteristics (e.g. growth rates and reproductive parameters), spatiotemporal population dynamics, and key ecosystem drivers (e.g. environmental forcing and predator-prey interactions) into a unified stock assessment framework. Specifically, we use an integrated length-to-age model implemented in Stock Synthesis (SS3), which enables the explicit inclusion of environmental covariates affecting biomass, recruitment patterns, and productivity, as well as the potential impacts of predator populations in natural mortality configuration. This approach strengthens the scientific foundation for sustainable management recommendations, ensuring that krill harvesting strategies align with CCAMLR's ecosystem-based management approach [@Constable2011; @Cavanagh2016; @Hill2019; @Constable2023; @Zhao2023; @CCAMLRWGSAM2024; @WGEMM2024]. The primary objective is to evaluate the statistical performance of alternative model configurations representing different hypotheses about ecosystem influences using a suite of diagnostic tools and performance metrics commonly applied in contemporary stock assessment practices. Our results provide empirical evidence for the value of ecosystem-informed model-based approach, demonstrating that the inclusion of environmental and predator covariates has impact in model fit, predictive skill, and structural uncertainty.

## Methodology

### Study Area

The study area covers the WAP, corresponding to FAO Subarea 48.1, one of the main regions for krill fishing activity. This area is also where CCAMLR is actively revising management approach at a finer spatial scale. To enhance the spatial resolution of our analysis of krill population dynamics, we used the five Management Units (MUs) (strata) proposed by CCAMLR: Bransfield Strait, Elephant Island, Gerlache Strait, Joinville Island, and the Southwest sector [@Dornam2021] (Fig. 1, S1). It is worth noting that these strata were originally developed for management purposes, without explicitly considering biological, ecological, or population-specific criteria [@Watters2013; @Constable2023; @Zaldua2024a]. Nevertheless, their subdivision enables a finer-scale analysis of krill data, increasing spatial resolution and enabling detection of heterogeneity among various data sources—whether from fisheries or environmental variables—thus providing a more detailed understanding of krill population dynamics. Furthermore, the conceptual framework underpinning the statistical model (Fig. \@ref(fig:conceptual)) assumes that MUs function as semi-closed stocks, where most biological processes occur within each MU, but with potential biomass and/or recruitment exchange between MUs driven by the oceanographic and geographic forces characteristic of the WAP.


```{r conceptual, out.width='75%', fig.cap="Conceptual model used to model dynamics population in Antarctic krill in WAP"}
knitr::include_graphics('figures/conceptual.jpg')
```

### Spatially Implicit Model

To represent spatial heterogeneity in krill dynamics, we implemented a spatially implicit modeling approach based on the *"areas-as-fleets"* methodology [@Waterhouse2014; @Punt2019; @Nielsen2021]. This approach treats distinct geographical regions as independent fleets, under the assumption that fishing and survey operations may have varying effects across space. Within this approach, each MU of the WAP is treated as a distinct fleet, allowing spatial differentiation in key parameters such as selectivity, catchability (*q*) and abundance indices. This is especially relevant for krill due to documented spatial variability and heterogeneity in both population processes and fishing effort [@Perry2019; @Perry2020; @Reiss2020; @Veytia2021; @SantaCruz2022]. By modeling each MU as a separate fleet, the assessment can estimate region-specific parameters that reflect this variability. Survey indices and biological compositions (e.g., length-frequency data) are assigned to their corresponding MU based on sampling location as defined by [@Dornam2021]. Similarly, fishery-dependent data—such as catch and size composition—are stratified by MU according to the reported fishing effort, allowing for regional variation in both abundance and observational processes. Given known difference in the population structure [@Kinzey2011; @Reiss2020; @Cutter2022], the selectivity is modeled separately for each MU to account for potential variations in size composition due to spatial heterogeneity or environmental conditions. This disaggregated structure allows the model to reflect small-scale spatial dynamics while maintaining analytical simplicity. The areas-as-fleets approach effectively incorporates regional variability in both population dynamics and observational processes without the added complexity of explicitly modeling movement [@Punt2019]. The model accounts for interannual variability in growth, maturity, and reproduction, assuming a single annual spawning pulse occurring between January and February [@Perry2019; @McBride2021]. Although MUs are treated as separate fleets, core population processes—such as recruitment and growth—are modeled collectively, representing the krill stock as a single interconnected population. This provides a more realistic representation of the krill population dynamics within Subarea 48.1.


### Length-to-Age Model Description

Like many invertebrates, krill present challenges for age determination, which complicates modeling population dynamics. Most modern stock assessments rely on age-structured modeling approaches to estimate marine population parameters [@Punt2013]. Although recent advancements have improved krill aging techniques [@Kilada2017], such methods have historically been unavailable for krill. Consequently, stock assessment for krill typically uses length data to approximate age structure through transition matrices. These matrices estimate the probability that individuals of a given length belong to specific age classes [@Laslett2004; @Lee2019; @Rudd2021; @Zhang2022; @Lee2024]. Given the scarcity—or absence—of direct age data in krill monitoring programs, length-based models offer a practical alternative to age-structured approaches. To date, all model-based krill assessments have used length-to-age frameworks [@Kinzey2015; @Kinzey2019; @Wang2021; @Green2023; @Dong2025]. Integrated models can effectively capture the age structure by transforming length observations into population-level dynamics [@Punt2013; @Lee2024]. On the other hand, length data, which are cost-effective and readily available [@Chong2019; @Canales2021], provide valuable insights into krill population structure due to their correlation with age [@Thanassekos2014]. To perform this transformation, models often use Age-Length Keys (ALKs). An ALK is a probabilistic matrix that estimates the likelihood of individuals of a given length belonging to specific age classes. This method assumes both aged and measured individuals are random samples from the same population and should be applied within the same time period to avoid biases [@ICCA2003; @Punt2003; @Punt2013; @Lee2024]. The ALK matrix is typically defined as follows:


$$
P(A = a \mid L = l) = \frac{N_{a,l}}{\sum_{a} N_{a,l}}
$$

where \( P(A = a \mid L = l) \) is the probability that an individual of length \( l \) belongs to age \( a \),  \( N_{a,l} \) is the number of individuals of age \( a \) observed at length \( l \) and the denominator \( \sum_{a} N_{a,l} \) ensures that the probabilities sum to 1 for each length class. This matrix is then used in the model to allocate observed length compositions into age classes, typically through multiplication with a length-frequency vector:

$$
N_a = \sum_{l} P(A = a \mid L = l) \cdot N_l
$$

where \( N_l \) is the number of fish observed at length \( l \), and \( N_a \) is the estimated number at age. The resulting ALK is shown in S1 Fig 7. 

In the stock assessment catch-at-length model, growth is modeled using a von Bertalanffy growth function lenght-at-age parameterization with parameters L~inf~, k, and coefficient of variation (CV), as outlined in @Mardones2023. This growth relationship is integrated into the model alongside weight-at-length, which is assumed known and calculated using the parameters from @Maschette2020 for krill. The model assumed linear growth below a predefined settlement age of 1.5 years. The asymptotic length ($L_{\infty}$) was determined by the estimated length-at-age, indicating that the model used $L_{\infty}$ as an upper growth boundary. Exponential decay of growth beyond maximum age was disabled, ensuring that growth patterns followed the von Bertalanffy assumption without artificial constraints. Growth variability was not explicitly modeled, and the coefficient of variation (CV) was assumed to be a function of length-at-age. Maturity was modeled as an age-based logistic function, with the first age of maturity set at 2-3 years. Regarding selectivity functions, it was modeled using a logistic formulation for the fishery fleet. The selectivity curve was defined by two key parameters: the size at 50% selectivity (inflection point) and the width of the selection range (95%). The fishery was characterized by multiple selectivity patterns, each defined by an inflection point and a selection range width. The estimated inflection points varied between 2.0 and 3.5 cm, while the selection range widths spanned between 2.0 and 4.0 cm depending of strata or "fleet". The survey selectivity was also modeled using a length-based logistic function. Inflection points ranged from 2.0 to 3.0 cm, with selection range widths consistently set at 1.0 cm. These differences in selectivity parameters are crucial for interpreting and modeling spatial heterogeneity among strata, as they reflect variability in size-dependent catchability across different regions and fleets (S1 Fig 6). The predator fleet followed a similar selectivity function, with a size-at-inflection point of 0.2 cm and a corresponding selection range width of 0.2 cm. assuming that the predator can capture a wider range of krill sizes. The stock-recruitment (SR) relationship was modeled using a standard Beverton-Holt model curve like @Kinzey2019, with the steepness parameter fixed at 0.85 in phase -4 to ensure consistency with previous studies. This reflects a weak stock-recruitment relationship, as krill recruitment largely depends on environmental conditions rather than spawning biomass [@Dong2025; @Kinzey2019; @Perry2020]. The unfished recruitment ($R_0$) was estimated with a mean recruitment of 23 in log-scale, with a prior of 10. Recruitment deviations were estimated to account for interannual variability in recruitment dynamics. The model used the deviation vector approach ($do\_recdev = 1$), where recruitment was modeled as a function of spawning stock biomass plus a deviation term. Cyclic patterns in recruitment were assumed each tree and five years [@Perry2019; @McBride2021; @Kinzey2019; @Thanassekos2014], and advanced recruitment options were enabled for model flexibility. Life history parameters—such as growth, weight-length relationship, natural mortality, and maturity—were used as priors to model the initial conditions of krill population dynamics, based on data from @Smith2023a, @Maschette2020, and @Kinzey2011. These parameters, along with initial selectivity assumptions, are summarized in Table \@ref(tab:parainit1). 



```{r parainit1, eval=TRUE}
library(here)
dir1.1 <- here::here(path.expand("~/DOCAS/SA_Krill/s1.1"))

start1 <- SS_readstarter(file = file.path(dir1.1, "starter.ss"), verbose = FALSE)
dat1   <- SS_readdat(file = file.path(dir1.1, start1$datfile), verbose = FALSE)
ctl1   <- SS_readctl(file = file.path(dir1.1, start1$ctlfil),
                     verbose = FALSE, use_datlist = TRUE, datlist = dat1)
fore1  <- SS_readforecast(file = file.path(dir1.1, "forecast.ss"), verbose = FALSE)
# Extraer parámetros
parbio <- ctl1$MG_parms[1:10, c(1:4,7)]
rownames(parbio) <- c("Nat M", "Lmin", "Lmax", "VonBert K",
                      "CV young", "CV old", "Wt a", "Wt b", "L50%", "Mat slope")

SRpar  <- ctl1$SR_parms[1:5, c(1:4,7)]
Qpar   <- ctl1$Q_parms[1:2, c(1:4,7)]
Selpar <- ctl1$size_selex_parms[1:20, c(1:4,7)]

# Combinar parámetros
parInit <- as.data.frame(rbind(parbio, SRpar, Qpar, Selpar))

# Añadir nombres de fila como columna "Parameter"
parInit$Parameter <- rownames(parInit)

# Añadir categorías y reordenar columnas
parInit <- parInit %>%
  mutate(INIT  = round(INIT, 2),
         PRIOR = round(PRIOR, 2))

# Crear vector de categorías (39 filas)
categories <- c(rep("Natural Mortality", 1),
                rep("Growth", 4),
                rep("Length-Weight Relation", 2),
                rep("Maturity", 2),
                rep("Stock-Recruit Relation", 5),
                rep("Catchability", 2),
                rep("Selectivity", 21))  # OJO: corregido a 23

# Añadir categorías y reordenar columnas
parInit <- parInit %>%
  mutate(Category = categories) %>%
  dplyr::relocate(Category, Parameter)

# Crear flextable
ft <- flextable(parInit)

ft <- set_caption(
  ft,
  "Input parameters for the initial SS3 krill model 
   (Each parameter includes limits (LO-HI), initial value (INIT), and phase. 
   Negative phase means the parameter is fixed.)"
)

ft <- theme_booktabs(ft)

ft <- autofit(ft) |> 
  set_table_properties(width = .7, layout = "autofit") |> 
  fontsize(size = 7, part = "all") |> 
  padding(padding = 1, part = "all") |>       # menos espacio interno
  line_spacing(space = 0.8, part = "all") |>  # menos espacio entre líneas
  align(align = "left", part = "all") |>    # todo centrado (compacto)
  width(j = 1, width = 1.5) |>                # columna Category más angosta
  width(j = 2, width = 2) |>                  # columna Parameter
  width(j = 3:7, width = 1)                   # resto de columnas iguales

ft

```


The statistical model to krill was configured using Stock Synthesis v 3.30.21 (SS3 hereafter) [@Methot2013]. SS3 is a structured stock assessment model, in the class of models called *"Integrated stock assessment model"* and has a set of sub-model that simulates growth, maturity, fecundity, recruitment, and mortality processes, and observation, with expected values for different types of data. The model is coded in Automatic Differentiation Model Builder (ADMB) [@Fournier2012; @Methot2013: @methot2020stock] with estimation parameters. Model conditioning is available in the code repository section of Suppl. Mat 1. All analysis about modeling was executed in R-CRAN [@R-base] and diagnoses and visualization of the outputs was made was through *r4ss* [@Taylor2019] and *ss3diags* packages [@Winker2023]. 


### Environmental variable modelling

To identify the most influential environmental drivers of krill recruitment to be considered in stock evaluation processes, we examined the relationship between a recruitment index and three key environmental variables described previously as critical in shaping krill population dynamics: Sea Surface Temperature (SST), Sea Ice Concentration (SIC), and Chlorophyll-a concentration (Chla) [@Flores2012; @Morley2020; @Saba2014; @Veytia2021; @Walsh2020]. Table \@ref(tab:envsa) summarizes the key characteristics of the environmental datasets used in the analysis, including sea ice, sea surface temperature (SST), and chlorophyll a. These variables were obtained from different satellite platforms and reanalysis products, namely Nimbus-7, ERA5, and Copernicus. The table details spatial and temporal resolution, as well as the temporal coverage of each dataset.

```{r envsa, eval=TRUE}
env_features <- data.frame(
  Feature = c("Sea Ice", "SST", "Chlorophyll a"),
  Platform = c("Nimbus-7", "ERA5", "E.U. Copernicus Marine Service"),
  Spatial_Resolution = c("25 × 25 km", "0.25º × 0.25º", "0.25º × 0.25º"),
  Temporal_Resolution = c("Daily", "Monthly", "Daily-Monthly"),
  Time_Range = c("1978 - Present", "1991 - Present", "2000 - Present"),
  stringsAsFactors = FALSE
)

#to word
ft_env <- flextable(env_features) |>
  set_header_labels(
    Feature = "Feature",
    Platform = "Platform",
    Spatial_Resolution = "Spatial Resolution",
    Temporal_Resolution = "Temporal Resolution",
    Time_Range = "Time Range"
  ) |>
  set_caption("Summary of environmental variables used in correlation analysis") |>
  color(part = "header", color = "black") |>
  theme_booktabs() |>
  fontsize(size = 10) 

ft_1 <- autofit(ft_env)
ft_2 <- set_table_properties(ft_1, width = .5, layout = "autofit")
ft_2
```


All environmental data were processed at their original spatial resolution using the R packages *sf* and *ncdf4* [@Pebezma2018; @Pierce2021], incorporating spatial manipulation, rasterization, and coordinate transformations. We modelled the relation the environmental influence on krill recruitment with a serie of linear models, progressively incorporating the environmental variables to identify the one with the greatest explanatory power. The initial model considered only the effect of strata (spatial), while subsequent models sequentially included Chla, SST, SIC and interaction terms. This modeling framework allowed us to determine the relative contribution of each factor and their interactions on the recruitment process. All models and their results can be found in the Supplementary Material 2.



One of the key challenges in this stock assessment framework is integrating ecosystem variables and drivers into the primary process of population dynamics [@Marshall2019] and SS3 addresses these approaches. According to [@methot2020stock], Stock Synthesis (SS3) can estimate recruitment levels as a function of the spawning biomass from the previous season, incorporating the effects of an environmental time series and a log-bias adjustment. This integrated approach allows for a more realistic and dynamic estimation of recruitment by linking it to both biological and environmental drivers in this way;

$$
E(\text{Recruitment}) = f(\text{SpBio}) \times \exp(B \times \text{envdata}) \times \exp\left(-0.5 \times \pi_R^2\right)
$$
$R$ represents the variability of deviations, adding to the variance caused by environmental factors. $SpBio$ represent spawning biomass, $envdata$ is vector of time series of environmental variable. Consequently, as the environmental effect accounts for more of the total recruitment variability, the residual $R$ should be reduced. However, the model does not automatically adjust for this. Based on the results of linear models, we will identify the environmental variable that exhibits the strongest statistical influence on krill recruitment. This variable will be selected for inclusion in the stock assessment model to capture the environmental contribution to recruitment variability. By integrating the most influential environmental driver, the model is expected to enhance the biological realism of recruitment estimates and improve the accuracy of population dynamics esttimates.


### Predator modelling 


Following @methot2020stock, natural mortality due to predation (*M2*) was incorporate through different types of observational data types, with each informing distinct aspects of predator-prey dynamics. In our krill assessment, we incorporated predator abundance from the three main penguin species in the Antarctic Peninsula: Adélie (*Pygoscelis adeliae*), Chinstrap (*Pygoscelis antarcticus*), and Gentoo (*Pygoscelis papua*)  from 399 colonies identified, located along the northern arc of the Antarctic Peninsula during the last two decades (2000–2020) obtained from the Mapping Application for Penguin Populations and Projected Dynamics ([MAPPPD](https://www.penguinmap.com/mapppd/sources/)). Predator abundance is processed as an index of predation "effort" allowing time-varying estimation of predation mortality rates in time. This follows the equation:

$$
M2_t = Q \cdot I_t
$$

where \( M2_t \) is the predation mortality in year *t*, \( I_t \) is the predator abundance index, and \( Q \) is a catchability coefficient. Additionally, length-frequency data of krill obtained from penguin diet samples from AMLR Program are used to characterize the size-selectivity of predation. These data inform predator-specific selectivity functions for *M2*, enabling the model to represent how predation varies with krill size. Total natural mortality (*M*) is thus partitioned as \(M = M_1 + \sum M_2 \), where \( M_1 \) is background mortality and \( \sum M_2 \) accounts for predator-specific contributions. Total mortality is expressed as \( Z = M_1 + M_2 + F \) combining natural and fishing-induced mortality. This dual approach—using predator abundance and diet composition—supports a temporally and size-structured representation of predation mortality, aligning with ecosystem-based assessment principles.


### Model Input Data: Fishery and Survey

Along with data on predators and environmental conditions, a fundamental input to the model was derived from fishery-dependent data and scientific monitoring programs. Fishery-dependent data were obtained from the Krill Fishery Monitoring Program under the CCAMLR SISO framework, including total reported catches, standardized CPUE (adjusted by vessel, area, and depth), and krill length-frequency distributions data were standardized using a fixed bin structure of 28 length intervals, each representing the lower edge of 0.2 cm width bins from 1.2 to 6.6 cm. Length data were assigned to partition code 0 (combined discard and retained) and sex code 0 (combined sexes), with a fixed sample size of 75 individuals per haul. This ensured consistency across years and strata and fleets (fishery, survey and predator), facilitating reliable temporal and spatial comparisons of size structure, covering the period from 1997 to 2020. Fishery-independent data originated from U.S. AMLR Program acoustic surveys included standarized biomass indices conducted between 1991 and 2011. Krill length compositions from AMLR surveys (provided by the Ecosystem Science Division of NOAA) was manipulate in the same structure that fishery-dependent data and handled according to stock assessment model templates requirements (Suppl. Mat. 2). All these data, together with the previously described ecosystem variables (environmental and predator-related), along with their temporal coverage and spatial scale, are summarized in Table \@ref(tab:data-sources) and illustrated in in S1, Fig. 4.


```{r data-sources, eval=TRUE}
library(flextable)
data <- data.frame(
  Source = c(
    "Krill Fishery Monitoring Program (CCAMLR SISO)",
    "Krill Fishery Monitoring Program (CCAMLR SISO)",
    "Krill Fishery Monitoring Program (CCAMLR SISO)",
    "AMLR Scientific Research Program",
    "Satellite Remote Sensing",
    "Predator Monitoring (MAPPPD)",
    "Predator Diet Composition (AMLR)"
  ),
  Description = c(
    "Total reported catches",
    "Standardized CPUE (by vessel, area, and depth)",
    "Length-frequency distributions (0.2 cm bins)",
    "Biomass indices by strata from net sampling",
    "Monthly chlorophyll-a concentration from EU Copernicus Marine Service (interpolated; doi:10.48670/moi-00021, doi:10.48670/moi-00148)",
    "Abundance by colony-specific trends of penguin populations",
    "Length-frequency of krill in predator diets"
  ),
  TemporalScale = c(
    "1997–2020",
    "1997–2020",
    "2000–2020",
    "1991–2011 (based on cruise periods)",
    "1997–present",
    "2000s–present",
    "1977–2020 (subset from 2000 used in this analysis)"
  ),
  SpatialScale = c(
    "By strata",
    "By strata",
    "By strata",
    "By strata",
    "Subarea 48.1",
    "By colony",
    "By colony"
  )
)

# # to word
ft_data <- flextable(data) %>%
  set_caption("Data sources used in the krill population dynamics modeling") %>%
  theme_booktabs() %>%
  fontsize(size = 9) %>%
  width(j = 1, width = 1.8) %>%
  width(j = 2, width = 2) %>%
  width(j = 3, width = 1.0) %>%
  width(j = 4, width = 0.8) %>%
  set_table_properties(width = 1, layout = "fixed") %>%
  color(part = "header", color = "black") %>%
  align(align = "left", part = "all")

ft_data

# to PDF

# kbl(data, format = "latex", 
#     booktabs = TRUE, 
#     caption = "Data sources used in the krill population dynamics modeling") %>%
#   kable_styling(latex_options = c("hold_position", "striped"), 
#                 font_size = 9, 
#                 full_width = FALSE) %>%
#   column_spec(1, width = "3cm") %>%
#   column_spec(2, width = "5cm") %>%
#   column_spec(3, width = "3cm") %>%
#   column_spec(4, width = "3cm")

```

\newpage

### Scenarios

We evaluated a set of model configurations that incorporate variations in predator "fleet" and environmental effects, and the impacts in spawning biomass, recruitment among others. Spatial heterogeneity was considered in all scenarios. The methodology involves assessing the statistical performance of the model under these configurations. Specifically, `s1.1` serves as the reference model, incorporating only fishery and survey data while accounting for spatial heterogeneity (implicit spatial model). The subsequent scenarios build upon this configuration to evaluate the effects of additional ecological components. `s1.2` extends `s1.1` by incorporating predator influences, allowing the model to assess the impact of predation on krill population dynamics. `s1.3` modifies `s1.1` by introducing an environmental variable, capturing potential environmental drivers. Finally, `s1.4` integrates both predator and environmental influences into the `s1.1` framework, providing a more realistic assessment of ecosystem interactions and their role in krill population dynamics (Table \@ref(tab:scenario)).

```{r scenario, eval=TRUE}
scenario_table <- data.frame(
  Scenario = c("s1.1", "s1.2", "s1.3", "s1.4"),
  Description = c(
    "Spatial data without environmental and predator components",
    "\"s1.1\" with predator components",
    "\"s1.1\" with environmental variable",
    "\"s1.1\" with both predator fleet and environmental variable"
  ),
  stringsAsFactors = FALSE
)
ft_scenarios <- flextable(scenario_table) |>
  set_header_labels(
    Scenario = "Scenario",
    Description = "Description"
  ) |>
  set_caption("Scenarios used for modelling dynamics in krill") |>
  theme_booktabs() |> 
  fontsize(size = 10) |>
  autofit() |> 
  set_table_properties(width = 1, layout = "autofit") |> 
  color(part = "header", color = "black") 
ft_scenarios
```

### Performance models and scenario comparison

Regarding performance and scenario comparison, @Carvalho2017;  @Carvalho2021b; @Merino2022a and @Kell2021 propose a set of "good practices" for conducting a structured diagnosis to ensure the reliability and robustness of stock assessment analyses. This diagnostic process was applied to the krill stock assessment and involved several key steps proposed by previous research. First, **convergence analysis** was conducted to evaluate whether the estimation algorithm reached a stable solution. This included reviewing parameter trace plots, gradients, and the Hessian matrix to ensure that all parameters were well-estimated.  Next, model fit to data was assessed by comparing observed and predicted values across key data sources, including catch, survey indices, and length composition. The *p-values* for the residual runs tests were computed for each of the four joint length compositions that are common in all models. The *p-values* were then combined into a single test statistic using Fisher's method @@Merino2022a:

$$ 
\chi^2_{2k} = -2 \sum \log(p_i)
$$

where \( p_i \) is the p-value for Length \( i \) and \( k \) are the degrees of freedom of the four *p-values* from the joint length compositions. Regarding model fit, **Pearson residuals** of predicted length distributions for krill were evaluated across four modeling scenarios, each incorporating different levels of ecosystem complexity. Pearson residuals are used to assess the goodness-of-fit by standardizing the differences between observed and predicted values, allowing for the detection of systematic patterns or biases in model predictions across size classes and sampling sources. **Retrospective analysis** and **hindcast cross-validation** were performed by sequentially removing five years of data regarding @HurtadoF2015. As part of the restrospective analysis, the Mohn parametrer was calculated as the mean relative error, defined as:

$$ 
\rho_M = \frac{1}{h} \sum_{y=1}^{h} \left( \frac{X_{T - y} - \hat{X}_{T - y}}{\hat{X}_{T - y}} \right)
$$

where \( X \) represents the quantities (such as spawning stock biomass (SSB) or fishing mortality (F)) for which \(\rho_M\) was calculated, and \( \hat{X} \) is the corresponding estimate from the reference model fitted to the full dataset. Year \( y \) was nominally considered as season one, \( T \) refers to the terminal assessment data year, and \( h \) denotes the number of retrospective peels, removing recent years of data ("peeling") and re-estimating the model, allowing for the calculation of retrospective bias (*Rho*) for key metrics such as Spawning Stock Biomass (SSB) and Fishing Mortality (F). To evaluate statistical differences in model performance, we analyzed **Root Mean Squared Error (RMSE)** values across four scenario configurations (`s1.1`, `s1.2`, `s1.3`, and ``s1.4``) RMSE measures the average magnitude of residuals, giving higher weight to large errors. Lower values indicate better predictive accuracy [@Carvalho2021b]. The RMSE values were extracted from the variance tuning diagnostics of each scenario and compiled into a data frame for statistical analysis. To test for overall differences among scenarios, a *one-way ANOVA* [@Sthle1989] was conducted, treating RMSE values as the dependent variable and scenario configurations as the categorical factor. Another quantitative statistical method used to evaluate model performance was the **Akaike Information Criterion (AIC)** [@Bozdogan1987]. This criterion balances model fit and complexity, facilitating comparisons across scenarios. Lower AIC values indicate more parsimonious models with better overall fit. The last one  check of perfomance analisys is **R0 Deviation**. This analisys measures variability or uncertainty in the estimated unfished recruitment (R0). High deviations may indicate poor estimation stability or model overparameterization [@Methot2013].

## Results

### Environmental data 

Based on linear models performances and ecological relevance, Chla emerged as the most influential predictor, therefore, this variable was selected for incorporation into the stock assessment model as an environmental covariate (Table 2, S2).  Figure \@ref(fig:Chlmap) presents a time series of Chl-a concentration (mg/m-3) in the waters around the Antarctic Peninsula from 2000 to 2020. Each panel represents a different year, showing spatial variations in Chl-a levels, which indicate phytoplankton biomass. The highest concentrations were observed along the coastal regions, while offshore areas exhibit lower Chl-a levels. 

<!-- ```{r mapachl, eval=FALSE, out.width="100%", eval=TRUE, fig.cap="Time series (2000-2020) to Chlorophyll in Subarea 48.1"} -->
<!-- knitr::include_graphics('figures/chla_grilled.png') -->
<!-- ``` -->

The interannual variability of this environmental index from 2000 to 2020 is shown in Figure \@ref(fig:chlindex). The figure illustrates marked fluctuations across years, with notable periods of higher-than-average chlorophyll variability. In particular, 2016 exhibits a pronounced peak in primary production, as described by @Costa2021, who attributed this anomalous increase to the El Niño event that occurred along the southeastern Pacific coast, transmitted to the Antarctic Peninsula region through teleconnection processes. Conversely, years such as 2011 and 2020 show significantly lower values.

```{r chlindex, eval=TRUE, out.width="100%", fig.height=2, fig.width=9, fig.cap="Interannual variability of the Chlorophyll Variability Index from 2000 to 2020. Positive anomalies (in red) and negative anomalies (in black) indicate below-average conditions"}
datos <- data.frame(
  anio = 2001:2020,
  variable = c(
    0.684, 0.693, 0.737, 0.683, 0.716, 0.693, 0.670,
    0.708, 0.653, 0.699, 0.642, 0.647, 0.672, 0.658, 0.694,
    0.764, 0.675, 0.724, 0.662, 0.622
  )
)

min_val <- min(datos$variable)
max_val <- max(datos$variable)
datos$indice_ambiental <- 2 * (datos$variable - min_val) / (max_val - min_val) - 1

ggplot(datos, aes(x = anio, y = indice_ambiental)) +
  geom_col(aes(fill = indice_ambiental > 0), width = 0.5) +
  scale_fill_manual(values = c("black", "red")) +
  #geom_line(color = "grey20", size = 1) +
  geom_hline(yintercept = 0, linetype = "dashed") +
  labs(title = "",
       x = "", y = "Env Index") +
  theme_bw() +
  theme(legend.position = "none",
        axis.text.x = element_text(angle = 90, hjust = 2))+
  scale_x_continuous(breaks = seq(from = 2000, to = 2020, by = 1))
```

### Predator component as driver of krill dynamics


The top panel in Figure \@ref(fig:mapapre) shows annual krill length distributions derived from penguin diet samples, displayed by predator species, showing that although median krill lengths remain relatively consistent over time, there is an interannual variability in the spread and distribution of sizes. Spatiotemporal distribution patterns of the three penguin species across the Antarctic Peninsula showed interannual variability from 2001 to 2020. Adélie penguins exhibited a relatively consistent presence across the northern sector of the Peninsula, with larger colony sizes concentrated toward the southwestern Bransfield Strait, particularly during the early 2000s. Chinstrap penguins were widespread and dominant in both spatial extent and colony size across most years, especially in the central and northeastern portions of the Peninsula. Gentoo penguins appeared in fewer and more localized sites but displayed a slight increase in spatial occurrence in the latter part of the time series (middle panel in Figure \@ref(fig:mapapre)).

```{r mapapre, eval=TRUE, out.width="100%", fig.cap= "Ecosystem indicators derived from penguin predator data in the Western Antarctic Peninsula. Top panel: Annual krill length distributions from penguin diet samples by species: Adélie (red), chinstrap (orange), and gentoo (black). A red horizontal line marks the 3.6 cm as recruit size for reference purposes. Middle panel: Spatial foraging colonies and relative intensity by species across years. Circles indicate locations and intensity of sampling by species, with circle size suggesting sampling effort or frequency. Bottom panel: Synoptic index of relative predator biomass, used as an ecosystem input in the stock assessment model."}
knitr::include_graphics('figures/Predator_fleet2.png')
```

The synoptic index of relative predator biomass accounts for variations in colony abundance, providing a robust metric that reflects the overall status of the penguin population (bottom panel in Figure \@ref(fig:mapapre)). The index appears to exhibit fluctuations over time, with a general decline from the early 1990s to the mid-2000s, followed by a period of relative stabilization and a strong decline toward the end of the time series. This decline has been extensively documented in the Antarctic Peninsula by studies such as [@Waterhouse2014; @Dunn2019; @Wethington2023], primarily associated with colonies of the Adélie penguin and Chinstrap penguin [@Strycker2020; @Talis2023]. This abundance series captures broad decadal declines in predator presence, particularly after 2015, potentially reflecting changes in prey availability, environmental conditions, or predator demography.



Natural mortality (M) of krill varied with age, exhibiting a sharp increase from age-0 (M = 0.30) to age-1 (M = 0.62), followed by a gradual asymptotic rise reaching approximately M = 0.76 from age-4 onward (S1. Fig x). This age-specific pattern suggests heightened vulnerability during the early life stages, potentially associated with increased predation pressure and lower physiological resilience. From age-1 onward, the progressive stabilization in mortality rates may reflect reduced susceptibility to size-selective predation and improved swimming capabilities. Notably, adult krill (ages 3–7) still experience considerable natural mortality (M ~ 0.75), suggesting sustained predation pressure. This is consistent with the dietary reliance of apex predators such as *Pygoscelis* penguins, which feed extensively on sub-adult and adult krill during the breeding season. 


### Assessment of model perfomance and complexity across ecological scenarios

Scenario `s1.1` represented the baseline spatial implicit model, incorporating only survey and fishery data, and resulted in the estimation of 71 parameters. In scenario `s1.2`, predator-related components were added, including biomass and size-selective predation patterns from key penguin colonies, increasing the parameter count to 107. Scenario `s1.3` introduced an environmental covariate as a recruitment driver into the baseline model, leading to the estimation of 96 parameters. Finally, scenario `s1.4` integrated both predator and environmental components, culminating in the highest model complexity with 128 estimated parameters.  All model scenarios successfully converged within acceptable tolerance thresholds, with final gradients below 1.00e-04, and positive-definite Hessian matrices confirming robust parameter estimation and local identifiability. 

The residuals are visualized by year and length bin, allowing an assessment of model fit over time and across the size structure of the population (Figure \@ref(fig:pearson)). In scenario `s1.1`, substantial lack of fit is evident across multiple years and length classes, particularly in the late 1990s and early 2000s. Positive Pearson residuals indicate that the model tends to underestimate frequencies of certain length bins, especially among smaller and mid-sized individuals, suggesting poor representation of recruitment and growth dynamics in the absence of environmental and predator effects. `s1.2`  shows some improvement in model fit, with slightly more balanced residuals. However, there are still consistent deviations in the mid-size ranges across multiple years, indicating that predation alone does not fully explain observed variability in length composition. In `s1.3`, there is a reduction in residual magnitude across several years and size classes, implying that incorporating environmental covariates helps align the model more closely with observed size distributions. This is particularly apparent in the early 2000s, where the residuals are closer to zero across most bins. Finally, `s1.4` shows the most consistent reduction in Pearson residuals across time and size structure. The residual patterns also indicate potentially concerning model misfits, particularly among adult individuals in several survey fleets operating in the Bransfield Strait, as well as among the largest size classes in the predator fleet, which likely represents penguin consumption data. The residuals exhibit consistent over- or under-estimation in specific length bins over multiple years, suggesting that the current model structure may not fully capture key processes affecting the abundance or selectivity of adult individuals. In the case of surveys in Bransfield, this could reflect spatial mismatches between predicted and observed size distributions or biases in survey selectivity for larger size classes. This spatial heterogeneity aligns with previous findings identifying this area as a core juvenile krill habitat [@Mardones2025; @Veytia2021, @Perry2020: @Perry2019]. Similarly, the residuals associated with the predator fleet suggest that the model may inadequately represent size-selective predation or the temporal dynamics of predator consumption. These patterns warrant further investigation into the assumptions underlying length selectivity and mortality, particularly for the adult component of the population, as well as potential ecosystem-driven variability not currently integrated in the model. Overall, the distribution of residuals is more homogeneous and centered around zero, indicating that the combined inclusion of predator and environmental drivers leads to the best model fit among the four scenarios.

\pagebreak

\begin{landscape}

```{r pearson, out.width="100%",  eval=TRUE, fig.cap= "Pearson residuals of predicted versus observed length-frequency distributions of Antarctic krill across four modeling scenarios (s1.1 to s1.4), each incorporating increasing levels of ecosystem complexity. Residuals are shown by fleet, survey, and predator source, allowing visual assessment of model fit across time and sampling components (BS=Bransfield Strait, EI= Elephant Island, GS= Gerlache Strait, JOIN= Joinville Island, SSWI= South West)"}
knitr::include_graphics('figures/Pearson2.png')
```

\end{landscape}

\pagebreak

#### Retrospective analysis

The retrospective pattern for fishing mortality (F) showed a marked increase in bias in scenario `s1.2` and `s1.4`, which included predator components, particularly in the 2017 (Figure \@ref(fig:rhoplot)). In this scenario, the combined rho value exceeded 3.5, indicating a strong retrospective pattern. Scenarios `s1.2` (predator only) and `s1.3` (environment only) also showed elevated rho values relative to `s1.1` (baseline model without ecosystem variables), although the magnitude was lower than in `s1.4`. In contrast, the retrospective pattern for spawning stock biomass (SSB) was consistently negative across all scenarios and years. However, models that included environmental components—`s1.3` and `s1.4`—tended to show larger negative biases in SSB, with scenarios `s1.2` and `s1.4` again exhibiting the most pronounced pattern. The combined rho values for SSB in `s1.3` and `s1.4` were close to –0.5 and –0.6, respectively, whereas `s1.1` showed a comparatively milder retrospective trend. 

```{r rhoplot, eval=TRUE, out.width="75%", fig.cap="Retrospective patterns for fishing mortality (F, left) and spawning stock biomass (SSB, right) across four modeling scenarios differing in ecosystem complexity. Each point represents the rho value for a given terminal year (2016–2019), with Combined indicating the average retrospective bias across years in different scenarios"}
knitr::include_graphics('figures/Rho_Value.jpeg')
```

#### Likelihood components

Across all scenarios, the total log-likelihood is primarily influenced by the Survey, Length composition, and Recruitment components, with minor contributions from parameter priors. The reference model (`s1.1`) displays the highest overall likelihood value, particularly due to a stronger fit to the Length composition and Survey data. However, this comes with an elevated penalty in the parameters priors categories, suggesting potential overfitting or parameter instability. In contrast, the ecosystem-informed scenarios—`s1.2` (with predator data), `s1.3` (with environmental data), and `s1.4` (with both)—show slightly lower total likelihoods. These models present more balanced likelihood contributions across data components and generally lower penalties for parameter priors and deviations, indicating a more stable parameterization despite reduced absolute fit. Notably, the Recruitment likelihood contribution decreases in the ecosystem scenarios compared to the reference, which aligns with previous results showing constrained recruitment variability when ecological drivers are included. These variations may reflect differences in model assumptions or input data between scenarios, which could affect how well each model fits particular data sources. Table \@ref(tab:tablike) shows the log-likelihood component values for each scenario. It summarizes the contributions of different data sources—such as survey indices, length composition, recruitment, and parameter priors—to the total likelihood in each model configuration (`s1.1` to `s1.4`).


```{r tablike, eval=TRUE}
parameter_comparison_table <- read_csv(
  here("data", 
       "parameter_comparison_table.csv")
) %>%
  slice(1:6)
 
  
parameter_comparison_table %>%
  mutate(across(
    where(is.numeric),
    ~ formatC(., format = "f", digits = 3, decimal.mark = ".")
  )) %>%
  flextable() %>%
  set_caption("Log-likelihood contributions of different components across model scenarios, including the total likelihood and individual contributions from survey indices, length composition data, recruitment, and parameter priors.") %>% 
  autofit() %>%
  theme_vanilla() %>%
  fontsize(size = 10, part = "all") %>%
  #font(fontname = "Arial", part = "all") %>%
  set_table_properties(width = .5, layout = "autofit")

```

#### Root Mean Square Error (RMSE)

The Root Mean Square Error (RMSE) analysis across four scenarios of increasing ecological complexity revealed that Scenario `s1.1` -which excludes both environmental and predator variables- showed the lowest median RMSE and the narrowest interquartile range, suggesting higher consistency in model fits to observed data. The inclusion of ecosystem variables in `s1.2` (predator only), `s1.3` (environment only), and `s1.4` (both) resulted in increases in RMSE dispersion and median values, although the differences were relatively moderate. Among the ecosystem-informed scenarios, `s1.3` and `s1.4` had comparable RMSE distributions, slightly exceeding those of the predator-only model (`s1.2`) (Figure \@ref(fig:rmseplot)). The increased variability in RMSE under these scenarios suggests a reduction in overall fit quality when ecological complexity is introduced, likely reflecting increased model structural uncertainty or misalignment between ecological covariates and population dynamics.


```{r rmseplot, fig.pos="H", out.width="50%", fig.cap="Distributions of Root Mean Square Error (RMSE) values for each scenario of the krill population model"}
knitr::include_graphics('figures/RMSE_Value.jpeg')
```


### Comparision outputs between scenarios

Model outputs under different ecosystem scenarios revealed substantial variation in krill population indicators, including total biomass, summary biomass, recruitment and spawning biomass (Figure \@ref(fig:compara)). The reference model (`s1.1`), which excluded environmental and predator components, consistently produced higher median estimates and wider uncertainty intervals across all population indicators. Inclusion of predator components (`s1.2`) or environmental variables (`s1.3`) led to reductions in central tendency and variability for all metrics, with `s1.3` (environment-only) showing the most constrained estimates, particularly for recruitment and spawning biomass. Scenario `s1.4`, which incorporated both environmental and predator components, resulted in intermediate biomass and recruitment estimates, with moderate variance compared to the other scenarios. Recruitment was especially sensitive to the inclusion of ecosystem components. The highest median recruitment was observed under `s1.2` (predator-only), while the lowest was seen in `s1.3` (environment-only), highlighting the contrasting influences of these ecological factors. 

```{r compara, eval=TRUE,  out.width="100%", fig.cap="Comparisons of krill population variables under scenarios of increasing ecosystem complexity"}
knitr::include_graphics('figures/comparision_total.jpeg')
```

Also, we compare the time series of different population variables (Figure \@ref(fig:compara1)). Total biomass estimates remain relatively stable across both scenarios until around 2010. From that point onward, both models show a marked increase in biomass, although the reference model predicts higher values than the ecosystem-informed model, particularly during the final assessment years (2018–2020). Recruitment at age 0 exhibits strong variability over time in coincidence with [@Dornam2021 and REF]. While both models show similar patterns, the reference model tends to estimate higher recruitment peaks, especially in recent years. Finally, spawning biomass (SpawnBio) follows trends similar to total biomass. Both models show a gradual increase after 2010, but the reference model again yields higher values in recent years. A *t-test*, assuming normality and homoscedasticity, revealed a statistically significant difference in spawning biomass estimates between models `s1.1` and `s1.4` (*t = 4.2682, df = 72, p < 0.001*), with a 95% confidence interval for the mean difference ranging from *1,387,011 to 3,818,074*. Mean spawning biomass estimates were *4,600,304 t* for `s1.1` and *1,997,762 t* for `s1.4`. A non-parametric *Wilcoxon rank sum test* further confirmed this difference (*W = 1256, p < 0.001*), reinforcing the robustness of the result despite minor warnings due to ties in the dataset. These findings demonstrate that incorporating predator and environmental covariates into the population model (scenario `s1.4`) leads to significantly lower estimates of spawning biomass. 


```{r compara1,eval=TRUE,  out.width="100%", fig.cap="Time series of population variables of krill in WAP: (A) total biomass, (B) summary biomass, (C) recruitment, and (D) spawning biomass"}
knitr::include_graphics('figures/alloutput_variable2.png')
```

Biologically, ln(R0) represents the expected log-scale recruitment in the absence of fishing, providing a proxy for the reproductive potential or productivity of the population under pristine conditions. Figure \@ref(fig:compara2) displays posterior density distributions for the natural logarithm of virgin recruitment level (ln(R0)) across four model configurations. The narrow and well-separated peaks across models suggest that each model configuration yields distinctly different estimates of recruitment potential, likely reflecting differences in underlying assumptions such as natural mortality, selectivity, or the inclusion of predation effects. From a biological perspective, the higher ln(R0) values in `s1.3` and `s1.4` suggest that, under those model assumptions, the krill population could sustain higher levels of recruitment in unfished conditions, potentially reflecting stronger compensatory dynamics or reduced natural mortality (e.g., lower predation pressure). This highlights the sensitivity of the recruitment parameter to assumptions about ecological drivers in the stock-recruitment relationship.

```{r compara2, eval=TRUE, out.width="75%", fig.cap="Estimated R0 parameter for Antarctic krill under four assessment scenarios. Models including predator and environmental data"}
knitr::include_graphics('figures/R0plot.png')

```



We compare the stock–recruitment relationship and productivity under all model scenarios with focus on differences between scenarios with and without ecosystem considerations (`s1.1` and `s1.4`). The left panel in Figure \@ref(fig:proplot) illustrates the relationship between spawning stock biomass (SSB) and recruitment across years, overlaid with a fitted Beverton-Holt function derived from the model with ecosystem covariates. Scenario `s1.1` (diamonds) displays a wider spread in recruitment estimates across the full range of SSB values, with several years (e.g., 2017, 2014) producing exceptionally high recruitment despite moderate to low SSB. In contrast, scenario `s1.4` (crosses), which integrates ecosystem variables, generally shows lower recruitment estimates, with reduced variance and more clustered residuals at low SSB values. The fitted Beverton-Holt curve (in blue) from `s1.4` captures the expected saturating recruitment response to increasing SSB. Notably, the inclusion of ecosystem variables appears to reduce extreme recruitment events and leads to a more stable, density-dependent recruitment pattern aligned with theoretical expectations. We defined the stock productivity as the ratio of recruitment to spawning stock biomass, provides a standardized measure of reproductive success and population resilience under different ecological and fishing pressures. The The right panel in Figure \@ref(fig:proplot) illustrates the relationship between recruitment per unit of spawning stock biomass (Recruitment/SSB) and relative spawning stock biomass (SSB/SSBo) for four scenarios (`s1.1` to `s1.4`). As expected under compensatory recruitment dynamics, all scenarios show a declining trend in productivity as SSB increases, indicating higher per-capita recruitment at low stock levels and reduced productivity as the population approaches its unfished biomass. The scenarios differ markedly in the magnitude of predicted productivity. Scenario `s1.1` and `s1.3` show higher productivity levels throughout the SSB range when compared to `s1.2` and `s1.4`. The latter scenario presents the lowest productivity values, indicating either reduced recruitment compensation or differences in the stock-recruitment parameters. These contrasting trends highlight how scenario-specific assumptions or structural choices influence estimates of productivity. 


```{r proplot, out.width="100%", fig.cap="Left panel: Stock–recruitment relationships for Antarctic krill under four assessment scenarios (s1.1 to s1.4). Left panel: Predicted recruitment as a function of spawning stock biomass (SSB), with fitted Beverton-Holt curves and annual labels for selected years. Right panel: Recruitment per unit of SSB plotted against relative SSB (SSB/SSBo)"}
knitr::include_graphics('figures/produc_com.png')
```

Autocorrelation functions (ACF) of model residuals were used to assess the temporal structure and potential misspecification across the four configurations (`s1.1` to `s1.4`) (Figure \@ref(fig:acfplot)). The reference model (`s1.1`) displays significant autocorrelation at the first three lags, indicating serial correlation and potential misspecification. In `s1.2`, which includes predator dynamics, the autocorrelation is more dispersed, with significant values at early lags and at lag 13, suggesting the introduction of temporal structure not fully accounted for. In contrast, `s1.3`, which incorporates environmental variability, shows a marked reduction in autocorrelation beyond the first lag, with most values within confidence bounds—indicating improved model independence. The fully integrated model (`s1.4`), combining predator and environmental effects, exhibits an autocorrelation pattern comparable to `s1.3`, with low residual autocorrelation overall, though slight structure persists at early lags.

```{r acfplot, fig.pos="H", out.width="100%", fig.cap="Autocorrelation function (ACF) plots of model residuals for four krill assessment scenarios Blue dashed lines indicate 95% confidence intervals"}
knitr::include_graphics('figures/ACF_Plot.png')
```

### Model scenarios diagnostics summary

The comparative evaluation of the four model scenarios (`s1.1` - `s1.4`) revealed key differences in model performance and complexity (Table \@ref(tab:diagnostics)).  All four scenarios achieved convergence, as indicated by a maximum gradient component of zero, ensuring that optimization reached a stable solution. Notably, the number of estimated parameters varied across models, with the full ecosystem model (`s1.4`) estimating the same number of parameters as the predator-only model (`s1.2`), while the environment-only model (`s1.3`) and the base model (`s1.1`) used fewer parameters. The Akaike Information Criterion (AIC) reveals stark contrasts in model performance. The environment-inclusive models (`s1.3` and `s1.1`) have substantially lower AIC values (3,234.9 and 2,668.1, respectively) compared to the predator-inclusive models (`s1.2` and s1.4), which exceed 50,000. These results suggest that environmental covariates contribute more effectively to explaining krill population dynamics than predator effects alone. The total likelihood (-logL) further supports this, showing much better fit in models `s1.1` and `s1.3`, while predator-inclusive models (`s1.2` and `s1.4`) show considerably poorer likelihood values. This pattern is reflected in the survey and length composition likelihood components, where again the environment-only model (`s1.3`) shows superior performance compared to predator scenarios. Root Mean Square Error (RMSE) for both index and length composition highlights better predictive accuracy in models without predators. Model `s1.1` and `s1.3` achieve lower RMSE values for both indices and length composition, indicating better alignment with observed data. In contrast, RMSE values are higher in predator-inclusive models (`s1.2` and `s1.4`), suggesting poorer fit. Similarly, the Mean Absolute Scaled Error (MASE) remains lower in `s1.1` and `s1.3` (0.427), compared to `s1.2` and `s1.4` (0.517), again highlighting improved predictive performance in models that exclude predator effects. Retrospective biases (rho values) provide insight into model consistency over time. Retrospective bias in spawning stock biomass (Retro_Rho_ssb) and forecast biomass (Forecast_Rho_ssb) is substantially reduced in models without predators, particularly `s1.1` (-0.233 and -0.333). Models including predators (`s1.2` and `s1.4`) show larger negative rho values, indicating stronger retrospective bias and less stability in biomass estimation. Fishing mortality bias (Rho_f) and its forecast also present serious concerns in predator-inclusive scenarios. Model `s1.4`, for instance, shows a high retrospective bias in fishing mortality (Rho_f = 6.912), compared to 1.585 in the base model (`s1.1`). This indicates over-sensitivity in mortality estimates when predator effects are included without sufficient constraint or supporting data.


```{r diagnostics, eval=TRUE, warning=FALSE, message=FALSE}
diagnostics <- read_csv(here("data", 
                             "model_diagnosis.csv"))
#write_csv(diagnostics, "model_diagnosis.csv")
flextable(diagnostics) %>%
  colformat_num(digits = 3) |>  
  set_caption("Statistical componentes to evaluate perfomances and diagnostic of model scenarios") %>%
  theme_booktabs() %>%
  fontsize(size = 10, part = "all") %>%
  autofit() %>%
  set_table_properties(width = .5, layout = "autofit")
```

<!-- # Discussion -->

<!-- (small guide) -->

<!-- * **Big summary / importance of this kind of integrated model in Krill** -->

<!-- * **Scientific main findings as extension of previous work (comparisons)** -->

<!-- * **Findings' scientific implications** -->

<!-- * **Forward-looking statements about the field as a whole** -->

<!-- * **A summary / importance of the engineering aspect of the work** -->

<!-- * **Limitations of Integrated models shown with questions that would be unanswered** -->

<!-- * **future work or recommendations to improve this** -->


## Discussion


This thesis chapter represents an advance the understanding Antarctic krill (*Euphausia superba*) population dynamics by addressing two fundamental objectives. First, it consolidates and harmonizes multiple long-term datasets collected over decades, particularly from Subarea 48.1 in the Western Antarctic Peninsula, into a unified statistical framework, responding to a recurrent management priority about intregrated model in krill emphasized by the CCAMLR. Second, it integrates ecosystem variables, such as environmental drivers and predator impacts, thereby moving beyond the traditional single-stocks species approach and taking an initial step toward ecosystem-informed stock assessments. This approach not only enhances the biological realism of krill population modelling but also reveals the structural complexity and statistical challenges that must be addressed to ensure its effective application in management Antarctic fishery contexts.


### Model Performance and Diagnostic Evaluation

Increasing model complexity can destabilize internal matrices and processes, potentially leading to convergence issues [@Kinzey2015; @Kinzey2019; @Dong2025]. While all models in this exercise successfully converged and produced Hessian matrices suitable for quantifying parameter uncertainty, the comprehensive diagnostic evaluation revealed important trade-offs between biological and ecological realism and statistical performance. While the ecosystem-informed models (particularly `s1.4`) showed improved biological realism through reduced Pearson residuals and better representation of length-frequency distributions, they also exhibited increased retrospective bias and reduced likelihood values compared to the baseline model (`s1.1`). The elevated retrospective bias in fishing mortality estimates for ecosystem scenarios, particularly the pronounced bias (rho = 6.912) in scenario `s1.4`, suggests potential overfitting or structural instability when both environmental and predator variables are simultaneously incorporated. The observed bias patterns may also reflect temporal mismatches between ecosystem variables and population responses, suggesting that lagged effects or non-linear relationships should be explored in future model development.

The shift toward ecosystem-based fisheries management highlights the need for stock assessment models that explicitly incorporate species interactions, environmental drivers, and predator pressures, as addressed in this analysis. For Antarctic krill, integrating ecosystem variables—such as predation pressure and environmental variability—can improve the realism of population dynamics; however, it also increases model complexity. This, in turn, affects model fit and raises parameter uncertainty, revealing a trade-off between traditional single-species assessments and ecosystem-informed approaches, as described by @Collie2016 and @Robertson2024. This chapter embraced that challenge and confirmed the inherent difficulties, yet we argue that this approach is a step in the right direction. It offers valuable insights for the evolving management strategy that CCAMLR seeks to implement for the krill fishery.

### Spatial Considerations and the Areas-as-Fleets Approach

Building on the analyses from [Chapter 3](#chap3), recognizing and accounting for spatial heterogeneity in krill populations across the large area of Subarea 48.1 was essential, particularly for determining how to incorporate this dimension into the integrated model. To address this, we applied the areas-as-fleets approach, a methodology that captures spatial differences and incorporates them into global estimates of population variables. This framework allows for a more realistic representation of local variability in abundance, selectivity, and population processes [@Nielsen2021; @Waterhouse2014]. However, some Management Units (MUs), which served as the structural basis for the areas-as-fleets approach, had limited data—for example, Joinville Island, with few years of survey and mfihery monitoring data. While these data limitations were not explicitly evaluated in this thesis, they could introduce complications in future integrated krill modeling efforts and should be carefully considered in subsequent analyses.

### Environmental Drivers and Recruitment Dynamics

The identification of chlorophyll-a concentration as the primary environmental driver affecting krill recruitment (see [Chapter 2](#chap2)) highlights the central role of primary productivity in shaping krill population dynamics [@Ainley2017; @Constable2023; @Saba2014].  This finding is consistent with recent studies emphasizing that krill recruitment is primarily driven by environmental conditions rather than spawning stock biomass [@ichii2023; @Perry2020; @Veytia2021].  The research identified chlorophyll-a concentration (Chla) as the most influential environmental predictor for krill recruitment. Models incorporating environmental variables (`s1.3` and `s1.4`) showed significantly lower Akaike Information Criterion (AIC) values, indicating better model performance and parsimony compared to models without environmental data. While these results highlight that integrating such environmental variables introduces complexity to model structure and performance, it also enhances model realism, a key challenge currently faced by stock assessment approaches. By explicitly integrating variables that are mechanistically linked to key population processes—such as recruitment—these models move beyond purely stochastic representations of stock productivity [@Haltuch2009; @Crone2019]. Such integration allows for a more process informed understanding of population variability, improving both explanatory power and predictive capacity. 

### Predator-Prey Interactions and Natural Mortality

The integration of penguin predation data into natural mortality estimates represents a novel approach in an integrated stock assessment, and even more so for krill. This size-selective predation pattern is biologically consistent with foraging theory and observed predator behavior, where no significant differences were identified amongkey predators like *Pygoscelis* penguins in the size ranges of krill in their diet [@Panasiuk2024]. The declining trend in the synoptic predator biomass index, particularly after 2015, reflects documented population declines in Antarctic Peninsula penguin colonies [@Emmerson2022; @Kruger2019; @Salmeron2023; @Trivelpiece2011a]. These declines, primarily affecting Adélie and Chinstrap penguin populations, have been attributed to climate change impacts, sea ice loss, and shifts in prey availability [@Kruger2019]. The incorporation of this declining predation pressure into the stock assessment model provides a mechanism for capturing ecosystem mediated changes in natural mortality that would otherwise be overlooked in traditional single-species approaches.

Regarding scenarios of modeling, the scenarios with explicit inclusion of predator components (`s1.2` and `s1.4`), showed increased bias in estimates of fishing mortality (F) and spawning stock biomass (SSB), they resulted in lower estimates of recruitment, total biomass, and spawning biomass. Incorporating predation mortality into stock assessment models is essential for accurately representing population dynamics in marine ecosystems and offering a more precautionary and arguably more realistic representation of krill dynamics. Efforts to incorporate predation as a modelling component in marine stock assessment processes are not new. @Hollowed2000 revealed higher total natural mortality rates than traditional life-history estimates and showed that ignoring predation uncertainty underestimated stock biomass uncertainty by up to 20%. Similarly, @Richards2016 introduced a predation pressure index for northern shrimp, combining predator biomass and diet frequency to scale natural mortality over time. This method improved model fit and reduced retrospective bias without requiring absolute predator consumption data, which are often unavailable. For Antarctic krill stock assessments, incorporating predation variability improves mortality estimates and supports ecosystem-based management. 




### Implications for Precautionary Management

While there are concerns about the performance of models that consider ecosystem variables, their estimates of key population variables—including spawning biomass, total biomass, and recruitment—are generally lower than those produced by models without ecosystem variables (S1).  The significant reduction in spawning biomass estimates between scenarios `s1.2` and `s1.4` (mean difference: 2.6 million tonnes) demonstrates that neglecting ecosystem variables may lead to overly optimistic stock assessments and potentially unsustainable harvest recommendations.  This conservative tendency could have significant implications for fisheries management, as these more precautionary estimates align with CCAMLR's new strategic guidelines, which call for the integration of ecosystem variables into predictive models to support precautionary management approaches. The more conservative estimates produced by ecosystem-informed models provide a buffer against uncertainty in population status, which is particularly important given the high variability and unpredictability of Antarctic marine ecosystems [@Hill2016]. However, the increased model complexity and associated statistical challenges must be balanced against the improved biological realism to ensure that management advice remains scientifically credible and operationally feasible.


### Model Limitations and Future Directions

Several limitations of the current modeling approach warrant discussion. First, the integration of predator effects relied on relatively coarse scale abundance indices that may not fully capture fine-scale predator-prey interactions or behavioral responses. This is primarily due to two reasons: the large spatial scale of Area 48.1, which covers more than 658,739 $km^{2}$, and the fact that CCAMLR's ecosystem observer deployment does not have observation points distributed throughout this entire area, which hampers comprehensive data collection across the region. In this sense, other predators such as whales [@Pallin2023; @Reisinger2022], which have a much greater impact on krill availability and abundance, were not included in this analysis. This exclusion was due to the high variability in methods and estimates used to assess whale abundances and consumption rates across time series, particularly in the Western Antarctic Peninsula (WAP), which complicates the integration of these data in a uniform framework. Studies suggest that whale consumption rates may even exceed around 20 times the total krill catch [@Biuw2024], highlighting the necessity of incorporating these key predators in future work to more accurately represent predation mortality. More detailed predator foraging data, including spatial overlap indices and prey switching behavior, could further enhance this analysis. Second, the environmental covariate framework, while effective in capturing chlorophyll driven recruitment variability, represents a simplified view of the complex environmental drivers affecting krill populations. Incorporating multivariate ecosystem variables must also be coupled with the development of models capable of handling such complexity; otherwise, contradictory signals may arise, potentially reducing model performance and compromising the reliability of outputs. Future studies should consider multivariate environmental relationships, threshold effects, and lagged responses that may better represent the mechanistic links between climate variability and krill population dynamics. Third, the current model assumes static relationships between ecosystem variables and parameters estimations. However, climate change may alter these relationships over time, requiring adaptive modeling approaches that can accommodate non-stationary ecosystem conditions. The development of time-varying parameter frameworks or regime specific models may be necessary to address this challenge.

Despite these limitations, and considering that this is an academic-scientific work, we strongly believe that this represents the future direction for the development of integrated krill models. Such approaches provide a foundation to generate scientifically grounded recommendations to CCAMLR, employing the most advanced fisheries science methods currently used worldwide.



\newpage


## Supplementary Material 

-   Supplementary Material 1: analysis, formulas, and outputs of stock assessment of Antarctic krill in WAP can be found in this [link](https://mauromardones.github.io/SA_Krill/). 

-   Supplementary Material 2: Correlation analysis between krill recruitment and environmental variables can be found in this [link](https://mauromardones.github.io/Krill_recruit_env/) 







